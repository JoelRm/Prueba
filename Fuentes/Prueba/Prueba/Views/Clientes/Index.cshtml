@model IEnumerable<Prueba.Models.Cliente>

@{
    ViewData["Title"] = "Index";
}

@*<h1>Index</h1>
*@
@*<p>
    <a asp-action="Create">Create New</a>
</p>*@

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<div class="form-group">
    <h3>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
        </svg>
        Añadir Cliente
    </h3>
</div>

<div>
    <div class="form-group">
        <small id="emailHelp" class="form-text text-muted">Please, add a Company to continue.</small>
    </div>
    <div class="form-group">
        <button type="button" class="btn btn-danger" onclick="AbrirModal();" @*data-toggle="modal" data-target=".bd-example-modal-lg"*@>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path>
            </svg>
            Añadir Cliente
        </button>
    </div>
    <div class="form-group">
         <table class="table">
    <thead class="table">
        <tr class="thead-dark">
            <th scope="col">
                @Html.DisplayNameFor(model => model.Nombre)
            </th>
            <th scope="col">
                @Html.DisplayNameFor(model => model.Compania)
            </th>
            <th scope="col">
                @Html.DisplayNameFor(model => model.Tipo)
            </th scope="col">
            @*<th>
                @Html.DisplayNameFor(model => model.Estado)
            </th>*@
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody id="idBodyClientes">

            @*@foreach (var item in Model) {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.Nombre)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Compania)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Tipo)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Estado)
                        </td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.IdCliente">Edit</a> |
                            <a asp-action="Details" asp-route-id="@item.IdCliente">Details</a> |
                            <a asp-action="Delete" asp-route-id="@item.IdCliente">Delete</a>
                            <button class = 'btn btn-danger' onclick='eliminarRegistro(" + @item.IdCliente + ");'> Eliminar </button>
                        </td>
                    </tr>
            }*@
        </tbody>
    </table>
    </div>
</div>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="modalAg">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
                    </svg>
                    Añadir Cliente
                </h5>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="inputEmail4">Nombre:*</label>
                            <input type="text" class="form-control" id="idNombre">
                        </div>
                        <div class="col-md-4">
                            <label for="inputEmail4">Pais:*</label>
                            <select id="idPais" class="form-control">
                                <option value="" selected>--Seleccione--</option>
                                <option value="Estados Unidos">Estados Unidos</option>
                                <option value="Puerto Rico">Puerto Rico</option>
                                <option value="Otros">Otros</option>
                            </select>
                            <small id="emailHelp" class="form-text text-muted">Please, add a Company to continue.</small>
                        </div>
                        <div class="col-md-4">
                            <label for="inputEmail4">Tipo de entidad :*</label>
                            <br/>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="Individuo" checked>
                                <label class="form-check-label" for="inlineRadio1">Individuo</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="Compañia">
                                <label class="form-check-label" for="inlineRadio2">Compañía</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="agregarCliente();">Save</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" id="btnCerrarModal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function () {
        ListarClientes();
    })

    function AbrirModal(){
        $('#modalAg').modal('show');
    }
    function ListarClientes() {
        $.ajax({
            type: "POST",
            url: "/Clientes/ListarClientes",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                if (data != null) {
                    var html = "";
                    if (data.length != 0) {
                        for (var i = 0; i < data.length; i++) {
                            html += "<tr>";
                            html += "<td>" + data[i].nombre + "</td>";
                            html += "<td>" + data[i].compania + "</td>";
                            html += "<td>" + data[i].tipo + "</td>";
                            html += "<td><button class = 'btn btn-danger' onclick='eliminarRegistro(" + data[i].idCliente + ");'> Eliminar </button></td>";
                            html += "</tr>";
                        }
                    } else {
                        html += "<tr><td colspan='7'>No existen registros</td></tr>";
                    }
                    document.getElementById("idBodyClientes").innerHTML = html;
                }
                else {
                    document.getElementById("idBodyClientes").innerHTML = "<tr><td colspan='7'>No existen registros</td></tr>";
                }
            },
            error: function (ex) {
                alert(ex.responseText);
                //ocultarLoader();
            }
        });
    }

    function eliminarRegistro(idCliente) {
        $.ajax({
            type: "POST",
            url: "@Url.Action("EliminarCliente")",
            dataType: "json",
            data: {idCliente: idCliente},
            success: function (data) {
                ListarClientes();
                toastr.success("Pruyeba");
            },
            error: function (ex) {
                alert(ex.responseText);
            }
        });
    }

    function agregarCliente() {
        var NombreCliente = document.getElementById("idNombre").value;
        var PaisCliente = document.getElementById("idPais").value;

        if (NombreCliente.length == 0) {
            alert("Se debe digitar un nombre");
            return;
        }
        if (PaisCliente == "") {
            alert("Se debe seleccionar un país");
            return;
        }

        var TipoCliente = $('input:radio[name=inlineRadioOptions]:checked').val()
        var Cliente = {
            Nombre: NombreCliente,
            Compania: PaisCliente,
            Tipo: TipoCliente
        }
        $.ajax({
            type: "POST",
            url: "@Url.Action("AgregarCliente")",
            dataType: "json",
            data: {objCliente: Cliente},
            success: function (data) {
                ListarClientes();
                limpiarControles();
                $('#modalAg').modal('hide')
            },
            error: function (ex) {
                alert(ex.responseText);
            }
        });
    }

    function limpiarControles() {
        document.getElementById("idNombre").value = "";
        document.getElementById("idPais").value = "";
    }

</script>

